<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bảng Thời Khóa Biểu</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f9;
            margin: 0;
            padding: 20px;
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        th, td {
            border: 1px solid #ddd;
            padding: 15px;
            text-align: center;
        }
        th {
            background-color: #B1E9FF;
            color: #333;
        }
        td {
            background-color: #fff;
            color: #555;
        }
        .time-cell {
            font-weight: bold;
        }
        .highlight {
            background-color: #FFD700;
        }
    </style>
</head>
<body>

<h1>Bảng Thời Khóa Biểu</h1>
<table id="schedule-table">
    <thead>
        <tr>
            <th>Thời Gian</th>
            <th>Thứ 2</th>
            <th>Thứ 3</th>
            <th>Thứ 4</th>
            <th>Thứ 5</th>
            <th>Thứ 6</th>
        </tr>
    </thead>
    <tbody id="schedule-body">
        <!-- Dữ liệu sẽ được thêm vào đây -->
    </tbody>
</table>

<script>
    // Hàm để lấy dữ liệu từ API và hiển thị lên bảng
    async function fetchAndDisplaySchedule() {
        try {
            const response = await fetch('https://script.google.com/macros/s/AKfycbxFI-MHhE2lkrvtsjzSd0HIfv3Ad3Lmg2BroeG3hpFR6bDttR8vawR5Cm0nhjzrFWs_Kg/exec');
            const data = await response.json();
            const scheduleBody = document.getElementById('schedule-body');
            scheduleBody.innerHTML = '';  // Xóa nội dung cũ

            data.forEach(item => {
                const timeCell = item.day.replace("\n", " ");
                const row = document.createElement('tr');

                // Thêm cột thời gian
                const timeColumn = document.createElement('td');
                timeColumn.textContent = timeCell;
                timeColumn.classList.add('time-cell');
                row.appendChild(timeColumn);

                const days = ["星期一", "星期二", "星期三", "星期四", "星期五"];
                days.forEach(day => {
                    const column = document.createElement('td');
                    column.textContent = item[day] ? item[day].replace("\n", " ") : '';
                    row.appendChild(column);
                });

                scheduleBody.appendChild(row);
            });

            highlightCurrentTime();
            setInterval(highlightCurrentTime, 60000);  // Cập nhật mỗi phút
        } catch (error) {
            console.error("Lỗi khi lấy dữ liệu từ API:", error);
        }
    }

    // Hàm để làm nổi bật thời gian hiện tại
    function highlightCurrentTime() {
        const now = new Date();
        const hours = now.getHours();
        const minutes = now.getMinutes();

        const rows = document.querySelectorAll("#schedule-body tr");

        rows.forEach(row => {
            row.classList.remove("highlight");  // Xóa lớp bôi đen trước đó
            const timeText = row.cells[0].textContent;

            const timeRange = timeText.match(/(\d{2}:\d{2})\s\|\s(\d{2}:\d{2})/);
            if (timeRange) {
                const startTime = timeRange[1].split(":").map(Number);
                const endTime = timeRange[2].split(":").map(Number);

                const startMinutes = startTime[0] * 60 + startTime[1];
                const endMinutes = endTime[0] * 60 + endTime[1];
                const currentMinutes = hours * 60 + minutes;

                if (currentMinutes >= startMinutes && currentMinutes < endMinutes) {
                    row.classList.add("highlight");
                }
            }
        });
    }

    fetchAndDisplaySchedule();
</script>

</body>
</html>
