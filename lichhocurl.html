<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Save Schedule as JSON</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
    </style>
</head>
<body>

<h1>Save Class Schedule</h1>

<!-- Nút bấm để lưu dữ liệu thành tệp JSON -->
<button id="saveButton">Save Schedule as JSON</button>

<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
<script>
    // API URL
    const apiUrl = "https://script.google.com/macros/s/AKfycbxwAb94t7_CS7bk6oPSEcICLTeuiGPlTi2jSjj_hsOMsBLH76pzIUAdsEMsszc6KmM/exec";

    // Hàm lấy dữ liệu từ API
    async function fetchData() {
        try {
            const response = await fetch(apiUrl);
            const data = await response.json();
            return data;
        } catch (error) {
            console.error("Error fetching data:", error);
            return null;
        }
    }

    // Hàm format dữ liệu thành định dạng cần lưu
    function formatData(data) {
        return data.map(item => {
            let formattedItem = {
                startTime: item.startTime,
                endTime: item.endTime,
                events: []
            };

            // Chuyển thông tin từ các ngày thành phần "events"
            Object.keys(item).forEach(date => {
                if (new Date(date).toString() !== "Invalid Date") {
                    formattedItem.events.push({
                        date: date,
                        summary: item[date].split('\n')[0],
                        location: item[date].split('\n')[1] || '',
                        description: item[date].split('\n')[2] || ''
                    });
                }
            });

            return formattedItem;
        });
    }

    // Hàm lưu dữ liệu vào tệp JSON
    async function saveDataAsJson() {
        const data = await fetchData();
        if (!data) return;

        const formattedData = formatData(data);

        // Chuyển đổi dữ liệu thành JSON và tải xuống
        const blob = new Blob([JSON.stringify(formattedData, null, 2)], { type: "application/json" });
        saveAs(blob, "lichhoc.json");
    }

    // Gắn sự kiện cho nút bấm
    document.getElementById("saveButton").addEventListener("click", saveDataAsJson);
</script>

</body>
</html>
