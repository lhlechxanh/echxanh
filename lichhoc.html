<!DOCTYPE html>
<html lang="vi">
  <link rel="icon" type="image/x-icon" href="https://salt.tikicdn.com/cache/256x256/ts/avatar/1c/b7/19/0d9b1ebdc3c6409a3007870cb1c45fb1.png">
    <!--  -->
        <!-- For Google -->
<meta name="description" content="EchXanh" />
<meta name="keywords" content="" />

<meta name="author" content="" />
<meta name="copyright" content="" />
<meta name="application-name" content="" />

<!-- For Facebook -->
<meta property="og:title" content="EchXanh" />
<meta property="og:type" content="article" />
<meta property="og:image" content="https://salt.tikicdn.com/cache/256x256/ts/avatar/1c/b7/19/0d9b1ebdc3c6409a3007870cb1c45fb1.png" />
<meta property="og:url" content="https://ipa.echxanh.xyz/" />
<meta property="og:description" content="EchXanh T√≥c D√†i" />
<meta property="fb:app_id" content="1044965976682473"/>
<!-- For Twitter -->
        <meta charset="UTF-8">
        <title>EchXanh</title>
        <link rel="stylesheet" href="./home.css">
        <link rel="stylesheet" href="home.css">
        <link href=' http://fonts.googleapis.com/css?family=Droid+Sans' rel='stylesheet' type='text/css'>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    </head>
    <meta name="description" content="EchXanh" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B·∫£ng Th·ªùi Kh√≥a Bi·ªÉu</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f9;
            margin: 0;
            padding: 20px;
        }

        header {
            background-color: #2980b9;
            padding: 15px 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .top-menu {
            display: flex;
            justify-content: space-around;
            flex-direction: column;
        }

        .top-menu a {
            color: white;
            margin: 10px 0;
            text-decoration: none;
            font-weight: bold;
            padding: 10px 15px;
            border-radius: 5px;
            transition: background-color 0.3s, transform 0.3s;
        }

        .top-menu a:hover {
            background-color: #1abc9c;
            transform: scale(1.1);
        }

        @media (min-width: 768px) {
            .top-menu {
                flex-direction: row;
            }
            .top-menu a {
                margin: 0 20px;
            }
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px; /* Th√™m kho·∫£ng c√°ch d∆∞·ªõi b·∫£ng */
        }

        th, td {
            border: 2px solid #8B4513;
            padding: 15px;
            text-align: center;
        }

        th {
            background-color: #B1E9FF;
            color: #333;
        }

        td.no-class {
            background-color: black; 
            color: white; 
        }

        /* Th√™m m√†u s·∫Øc cho c√°c ng√†y trong tu·∫ßn */
        td:nth-child(2) { background-color: #D1F2EB; }
        td:nth-child(3) { background-color: #F9E79F; }
        td:nth-child(4) { background-color: #FADBD8; }
        td:nth-child(5) { background-color: #F5B7B1; }
        td:nth-child(6) { background-color: #E8DAEF; }

        .time-cell {
            font-weight: bold;
            background-color: #A3C1AD;
        }

        .highlight {
            background-color: #FFD700; 
        }

        .new-content {
            background-color: #ffeb3b; 
            font-weight: bold;
        }

        /* CSS cho ph·∫ßn k·∫øt qu·∫£ */
        .result {
            background-color: #fff;
            padding: 15px;
            border: 2px solid #2980b9;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            text-align: center;
            margin-bottom: 20px; /* Th√™m kho·∫£ng c√°ch ph√≠a d∆∞·ªõi */
        }
    </style>
</head>
<body>

<header>
    <nav class="top-menu">
        <a href="lichhoc.html">L·ªãch H·ªçc</a>
        <a href="vongquay.html">V√≤ng Quay May M·∫Øn</a>
    </nav>
</header>

<h1>B·∫£ng Th·ªùi Kh√≥a Bi·ªÉu</h1>
<div id="result" class="result">ƒêang l·∫•y th√¥ng tin ph√≤ng tr·ª±c nh·∫≠t üê∏üëå</div> <!-- Di chuy·ªÉn div result l√™n tr√™n b·∫£ng -->
<table id="schedule-table">
    <thead>
        <tr>
            <th>Th·ªùi Gian</th>
            <th>Th·ª© 2</th>
            <th>Th·ª© 3</th>
            <th>Th·ª© 4</th>
            <th>Th·ª© 5</th>
            <th>Th·ª© 6</th>
        </tr>
    </thead>
    <tbody id="schedule-body"></tbody>
</table>

<script>
    const apiURL = 'https://script.google.com/macros/s/AKfycbxFI-MHhE2lkrvtsjzSd0HIfv3Ad3Lmg2BroeG3hpFR6bDttR8vawR5Cm0nhjzrFWs_Kg/exec';

    async function fetchData() {
        try {
            const response = await fetch(apiURL);
            if (!response.ok) {
                throw new Error('M·∫°ng l·ªói ho·∫∑c kh√¥ng th·ªÉ l·∫•y d·ªØ li·ªáu.');
            }
            const data = await response.json();
            return data; // Tr·∫£ v·ªÅ d·ªØ li·ªáu t·ª´ API
        } catch (error) {
            console.error('C√≥ l·ªói x·∫£y ra:', error);
            document.getElementById("result").innerHTML = "<p>Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu.</p>";
        }
    }

    async function checkDate() {
        const dataFromAPI = await fetchData();
        if (!dataFromAPI) return; // N·∫øu kh√¥ng c√≥ d·ªØ li·ªáu, tho√°t

        // L·∫•y ng√†y h√¥m nay v√† ng√†y mai theo ƒë·ªãnh d·∫°ng UTC
        const today = new Date();
        const todayUTC = new Date(today.getUTCFullYear(), today.getUTCMonth(), today.getDate()).toISOString();
        const tomorrowUTC = new Date(today.getUTCFullYear(), today.getUTCMonth(), today.getDate() + 1).toISOString();

        // T√¨m ki·∫øm c√°c ng√†y tr√πng kh·ªõp
        const todayClasses = dataFromAPI.filter(item => item.date1 === todayUTC);
        const tomorrowClasses = dataFromAPI.filter(item => item.date1 === tomorrowUTC);
        
        // Hi·ªÉn th·ªã k·∫øt qu·∫£
        const resultDiv = document.getElementById("result");
        resultDiv.innerHTML = ""; // X√≥a k·∫øt qu·∫£ tr∆∞·ªõc ƒë√≥

        // Th√™m ti√™u ƒë·ªÅ cho h√¥m nay
        resultDiv.innerHTML += "<h3>H√¥m nay:</h3>";
        if (todayClasses.length > 0) {
            todayClasses.forEach(item => {
                resultDiv.innerHTML += `<p>Ng√†y: ${item.dayOfWeek1}, Ph√≤ng: ${item.room1}</p>`;
            });
        } else {
            resultDiv.innerHTML += "<p>Kh√¥ng c√≥ l·ªõp n√†o cho h√¥m nay.</p>";
        }

        // Th√™m ti√™u ƒë·ªÅ cho ng√†y mai
        resultDiv.innerHTML += "<h3>Ng√†y Mai:</h3>";
        if (tomorrowClasses.length > 0) {
            tomorrowClasses.forEach(item => {
                resultDiv.innerHTML += `<p>Ng√†y: ${item.dayOfWeek1}, Ph√≤ng: ${item.room1}</p>`;
            });
        } else {
            resultDiv.innerHTML += "<p>Kh√¥ng c√≥ l·ªõp n√†o cho ng√†y mai.</p>";
        }
    }

    // G·ªçi h√†m ki·ªÉm tra ng√†y khi trang ƒë∆∞·ª£c t·∫£i
    window.onload = checkDate;

    const fetchAndDisplaySchedule = async () => {
        try {
            const response = await fetch(apiURL);
            const data = await response.json();
            const scheduleBody = document.getElementById('schedule-body');

            // T·∫°o b·∫£ng th·ªùi kh√≥a bi·ªÉu
            scheduleBody.innerHTML = data.map(item => {
                const timeCell = item.day.replace("\n", " ");
                const days = ["ÊòüÊúü‰∏Ä", "ÊòüÊúü‰∫å", "ÊòüÊúü‰∏â", "ÊòüÊúüÂõõ", "ÊòüÊúü‰∫î"];
                const dayCells = days.map(day => {
                    const cellContent = item[day] ? item[day].replace("\n", " ") : '';
                    return `<td class="${cellContent ? 'new-content' : 'no-class'}">${cellContent || 'Kh√¥ng c√≥ ti·∫øt'}</td>`;
                }).join('');

                // Ch·ªâ t·∫°o d√≤ng n·∫øu c√≥ th·ªùi gian
                return timeCell.trim() ? `<tr><td class="time-cell">${timeCell}</td>${dayCells}</tr>` : '';
            }).filter(row => row).join(''); // L·ªçc c√°c d√≤ng r·ªóng

            highlightCurrentTime();
            setInterval(highlightCurrentTime, 60000);
        } catch (error) {
            console.error("L·ªói khi l·∫•y d·ªØ li·ªáu t·ª´ API:", error);
        }
    };

    const highlightCurrentTime = () => {
        const now = new Date();
        const currentMinutes = now.getHours() * 60 + now.getMinutes();
        const rows = document.querySelectorAll("#schedule-body tr");

        rows.forEach(row => {
            const timeText = row.cells[0].textContent;
            const timeRange = timeText.match(/(\d{2}:\d{2})\s\|\s(\d{2}:\d{2})/);
            row.classList.remove("highlight");

            if (timeRange) {
                const [startMinutes, endMinutes] = [timeRange[1], timeRange[2]].map(time => {
                    const [h, m] = time.split(":").map(Number);
                    return h * 60 + m;
                });

                if (currentMinutes >= startMinutes && currentMinutes < endMinutes) {
                    row.classList.add("highlight");
                    row.cells[0].classList.add("highlight");

                    for (let i = 1; i < row.cells.length; i++) {
                        if (row.cells[i].textContent) {
                            row.cells[i].classList.add("highlight");
                        }
                    }
                }
            }
        });
    };

    fetchAndDisplaySchedule();
</script>

</body>
</html>
